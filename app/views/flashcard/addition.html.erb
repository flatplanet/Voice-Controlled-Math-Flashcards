
 <style>
  .speech {border: 1px solid #DDD; width: 300px; padding: 0; margin: 0}
  .speech input {border: 0; width: 240px; display: inline-block; height: 40px;}
  .speech img {float: right; width: 40px }
</style>
  
<script>


function speak(text) {
    var msg = new SpeechSynthesisUtterance();
    var voices = speechSynthesis.getVoices();
    msg.voice = voices[10];
    msg.voiceURI = 'native';
    msg.volume = 1;
    msg.rate = 1;
    msg.pitch = 2;
    msg.text = text;
    msg.lang = 'en-US';

    speechSynthesis.speak(msg);
    
}

speak('<%= @speech %>');

setTimeout(startDictation, 1000)


function startDictation() {
 
    if (window.hasOwnProperty('webkitSpeechRecognition')) {
 
      var recognition = new webkitSpeechRecognition();
 
      recognition.continuous = true;
      recognition.interimResults = false;
 
      recognition.lang = "en-US";
      recognition.start();
 
      recognition.onresult = function(e) {
        document.getElementById('transcript').value
                                 = e.results[0][0].transcript;
        setTimeout(recognition.stop, 100000)
        //recognition.stop();
        document.getElementById('labnol').submit();
      };
 
      recognition.onerror = function(e) {
        recognition.stop();
      }
 
    }
  }

</script>


<h1>Flashcards</h1>
<h4>Addition</h4>
<center>
<h1><%= @random1 %> + <%= @random2 %> = ?</h1>
<br/><br/>


<br/><%= @result %>
<br/><br/>

<%= form_tag addition_path, :method => 'POST', id: 'labnol' do %>
    <div class="speech">
    <% @count += 1 %>
    
    <%= text_field_tag 'answer', nil, id: 'transcript', placeholder: 'Speak' %>
    <%= hidden_field_tag(:num1, @random1) %>
    <%= hidden_field_tag(:num2, @random2) %>
    <%= hidden_field_tag(:count, @count) %>
    
    <img onclick="startDictation()" src="//i.imgur.com/cHidSVu.gif" />
    </div>
<% end %>
<br/>
<br/><%= @category %><br/>
<%= @item %>

<!-- HTML5 Speech Recognition API -->

</center>

